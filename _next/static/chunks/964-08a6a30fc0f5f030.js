"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4269:(e,t,n)=>{n.d(t,{cn:()=>i});var a=n(2821),r=n(5889);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,r.QP)((0,a.$)(t))}},5894:(e,t,n)=>{n.d(t,{dj:()=>u});var a=n(2115);let r=0,i=new Map,l=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},o=[],s={toasts:[]};function d(e){s=((e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:n}=t;return n?l(n):e.toasts.forEach(e=>{l(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===n||void 0===n?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}})(s,e),o.forEach(e=>{e(s)})}function c(e){let{...t}=e,n=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:n});return d({type:"ADD_TOAST",toast:{...t,id:n,open:!0,onOpenChange:e=>{e||a()}}}),{id:n,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:n}})}}function u(){let[e,t]=a.useState(s);return a.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:c,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},9832:(e,t,n)=>{n.d(t,{PageEditorProvider:()=>c,J:()=>u});var a=n(5155),r=n(2115),i=n(5894);let l=async(e,t)=>{let n=async e=>{let t=await fetch(e);if(t.ok)return t.json();throw Error("Failed to load ".concat(e))},a=e=>({...e,elements:e.elements.map((e,t)=>{var n;return{...e,zIndex:null!=(n=e.zIndex)?n:t+1,status:"idle"}})});try{let t=await n(e);return a(t)}catch(r){if(console.error("Failed to load ".concat(e),r),t)try{let e=await n("error.json");return a(e)}catch(e){console.error("Failed to load error.json",e)}throw Error("Failed to load initial configuration. Please make sure ".concat(e," exists in the public folder."))}},o={isMounted:!1,isEditMode:!1,isAuthenticated:!1,showPasswordPrompt:!1,passwordInput:"",config:{elements:[]},contextMenu:{visible:!1,x:0,y:0},editingElement:null,selectedElementIds:[],showJsonExport:!1,isPageLoading:!1,draggingState:null,resizingState:null,selectionBox:null};function s(e,t){switch(t.type){case"SET_IS_MOUNTED":return{...e,isMounted:t.payload};case"SET_IS_EDIT_MODE":return{...e,isEditMode:t.payload};case"SET_IS_AUTHENTICATED":return{...e,isAuthenticated:t.payload};case"SET_SHOW_PASSWORD_PROMPT":return{...e,showPasswordPrompt:t.payload};case"SET_PASSWORD_INPUT":return{...e,passwordInput:t.payload};case"SET_CONFIG":return{...e,config:t.payload};case"UPDATE_ELEMENTS":return{...e,config:{...e.config,elements:t.payload}};case"SET_CONTEXT_MENU":return{...e,contextMenu:t.payload};case"SET_EDITING_ELEMENT":return{...e,editingElement:t.payload};case"SET_SELECTED_ELEMENT_IDS":return{...e,selectedElementIds:t.payload};case"SET_SHOW_JSON_EXPORT":return{...e,showJsonExport:t.payload};case"SET_IS_PAGE_LOADING":return{...e,isPageLoading:t.payload};case"SET_DRAGGING_STATE":return{...e,draggingState:t.payload};case"SET_RESIZING_STATE":return{...e,resizingState:t.payload};case"SET_SELECTION_BOX":return{...e,selectionBox:t.payload};default:return e}}let d=(0,r.createContext)(void 0),c=e=>{let{children:t}=e,n=function(){let[e,t]=r.useReducer(s,o),{toast:n}=(0,i.dj)(),a=r.useRef(null),d=r.useRef({x:0,y:0});r.useEffect(()=>{t({type:"SET_IS_MOUNTED",payload:!0});let e=new URLSearchParams(window.location.search).get("config");l(e?e.endsWith(".json")?e:"".concat(e,".json"):"configuration.json",e).then(e=>t({type:"SET_CONFIG",payload:e})).catch(e=>{n({variant:"destructive",title:"Failed to load initial configuration",description:e.message})})},[n,t]),r.useEffect(()=>{let t=e.config.elements.find(e=>"page-title"===e.id),n=t?t.text:"Dynamic Page";if(n&&(document.title=n),e.config.favicon){let t=document.querySelector("link[rel~='icon']");t||((t=document.createElement("link")).rel="icon",document.getElementsByTagName("head")[0].appendChild(t)),t.href=e.config.favicon}},[e.config]);let{handleEditModeToggle:c,handlePasswordSubmit:u}=function(e,t){let{toast:n}=(0,i.dj)(),{isAuthenticated:a,passwordInput:l,config:o}=e;return r.useEffect(()=>{if(o.editorPassword){let e=new URLSearchParams(window.location.search),a=e.get("editorPassword");a&&(a===o.editorPassword?(t({type:"SET_IS_AUTHENTICATED",payload:!0}),"true"===e.get("edit")&&t({type:"SET_IS_EDIT_MODE",payload:!0})):n({variant:"destructive",title:"Authentication Failed",description:"Incorrect password provided in URL."}))}},[o.editorPassword,n,t]),{handleEditModeToggle:r.useCallback(e=>{e&&!a?t({type:"SET_SHOW_PASSWORD_PROMPT",payload:!0}):(t({type:"SET_IS_EDIT_MODE",payload:e}),e||t({type:"SET_SELECTED_ELEMENT_IDS",payload:[]}))},[a,t]),handlePasswordSubmit:r.useCallback(()=>{l===(o.editorPassword||"admin")?(t({type:"SET_IS_AUTHENTICATED",payload:!0}),t({type:"SET_SHOW_PASSWORD_PROMPT",payload:!1}),t({type:"SET_PASSWORD_INPUT",payload:""}),"true"===new URLSearchParams(window.location.search).get("edit")&&t({type:"SET_IS_EDIT_MODE",payload:!0})):n({variant:"destructive",title:"Authentication Failed",description:"Incorrect password."})},[o.editorPassword,l,n,t])}}(e,t),{handleMouseDown:E,handleTouchStart:p,handleTouchMove:f,handleTouchEnd:T,handleContainerClick:y,handleCanvasMouseDown:S,handleResizeStart:h,handleContextMenu:_,closeContextMenu:m,addElement:g,deleteElement:I,openEditModal:w,handleUpdateElement:D,handleElementClick:x,getElementRect:v,handleMouseMove:b}=function(e,t,n,a){let{toast:l}=(0,i.dj)(),{isEditMode:o,selectedElementIds:s,config:d,draggingState:c,resizingState:u,isPageLoading:E,contextMenu:p}=e,f=r.useRef(null),T=r.useRef(!1),y=r.useRef({x:0,y:0}),S=r.useRef(null),h=r.useRef(!1),_=r.useRef(!1),m=r.useCallback(function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],t({type:"UPDATE_ELEMENTS",payload:e})},[t]),g=r.useCallback(()=>{t({type:"SET_CONTEXT_MENU",payload:{visible:!1,x:0,y:0}})},[t]),I=r.useCallback(e=>{let t=Math.max(0,...d.elements.map(e=>e.zIndex||0)),a={id:Date.now().toString(),type:e,x:p.x,y:p.y,zIndex:t+1,text:"text"===e?"New Text":void 0,icon:"icon"===e?"Smile":void 0,src:"image"===e?d.defaultImageUrl||"https://picsum.photos/seed/".concat(Date.now(),"/200/300"):void 0,width:"image"===e?200:void 0,height:"image"===e?300:void 0,aspectRatio:"image"===e?200/300:void 0,url:"button"===e?d.defaultRestUrl:void 0,color:"#87CEEB",fontSize:16,fontFamily:"'PT Sans', sans-serif",status:"idle"};if("button"===a.type&&(a.text="New Button"),n.current){let e=n.current.getBoundingClientRect();a.x-=e.left,a.y-=e.top}m([...d.elements,a]),g()},[d.elements,d.defaultImageUrl,d.defaultRestUrl,p.x,p.y,m,g,n]),w=r.useCallback(()=>{s.length>0&&(m(d.elements.filter(e=>!s.includes(e.id))),t({type:"SET_SELECTED_ELEMENT_IDS",payload:[]})),g()},[d.elements,s,m,g,t]),D=r.useCallback(()=>{if(1===s.length){let e=d.elements.find(e=>e.id===s[0]);e&&t({type:"SET_EDITING_ELEMENT",payload:e})}g()},[d.elements,s,g,t]),x=r.useCallback(e=>{m(d.elements.map(t=>t.id===e.id?e:t)),t({type:"SET_EDITING_ELEMENT",payload:null})},[d.elements,m,t]),v=r.useCallback(async e=>{if(!o&&e.url){if("text"===e.type)return void("back"===e.url.toLowerCase()?window.history.back():window.open(e.url,"_self"));if("button"===e.type)try{let t=await fetch(e.url);if(!t.ok)throw Error("Request failed with status ".concat(t.status))}catch(e){l({variant:"destructive",title:"Request Failed",description:"The request to the specified URL failed."})}else{if(E)return;t({type:"SET_IS_PAGE_LOADING",payload:!0});try{let t=await fetch(e.url);if(!t.ok)throw Error("Request failed with status ".concat(t.status))}catch(e){l({variant:"destructive",title:"Request Failed",description:"The request to the specified URL failed."})}finally{t({type:"SET_IS_PAGE_LOADING",payload:!1})}}}},[o,E,l,t]),b=r.useCallback(function(e,n,a){let r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!o)return;t({type:"SET_SELECTED_ELEMENT_IDS",payload:r=i?s.includes(e)?s.filter(t=>t!==e):[...s,e]:s.includes(e)?s:[e]});let l=new Map;d.elements.forEach(e=>{r.includes(e.id)&&l.set(e.id,{x:e.x,y:e.y})}),t({type:"SET_DRAGGING_STATE",payload:{isDragging:!0,initialPositions:l,startX:n,startY:a}})},[o,s,d.elements,t]),C=r.useCallback((e,t)=>{if(!c||!n.current)return;let a=e-c.startX,r=t-c.startY;m(d.elements.map(e=>{let t=c.initialPositions.get(e.id);if(t){let n=t.x+a,i=t.y+r;return{...e,x:n,y:i}}return e}),!0)},[c,d.elements,m,n]),M=r.useCallback(()=>{c&&t({type:"SET_DRAGGING_STATE",payload:null}),f.current&&(clearTimeout(f.current),f.current=null)},[c,t]),N=r.useCallback((e,n)=>{if(e.stopPropagation(),!o)return;let a=d.elements.find(e=>e.id===n);if(a&&a.width&&a.height)t({type:"SET_RESIZING_STATE",payload:{isResizing:!0,elementId:n,startX:"touches"in e?e.touches[0].clientX:e.clientX,startY:"touches"in e?e.touches[0].clientY:e.clientY,initialWidth:a.width,initialHeight:a.height}})},[o,d.elements,t]),P=r.useCallback((e,t)=>{if(!u||!u.isResizing)return;let n=e-u.startX,a=d.elements.find(e=>e.id===u.elementId);if(!a||!a.aspectRatio)return;let r=u.initialWidth+n,i=r/a.aspectRatio;m(d.elements.map(e=>e.id===u.elementId?{...e,width:Math.max(20,r),height:Math.max(20,i)}:e),!0)},[u,d.elements,m]),A=r.useCallback(()=>{(null==u?void 0:u.isResizing)&&(m([...d.elements]),t({type:"SET_RESIZING_STATE",payload:null}))},[u,d.elements,m,t]),k=r.useCallback(e=>{if(!n.current)return null;let t=d.elements.find(t=>t.id===e),a=n.current.querySelector('[data-element-id="'.concat(e,'"]'));return t&&a?{id:e,x:t.x,y:t.y,width:a.offsetWidth,height:a.offsetHeight,left:t.x,top:t.y,right:t.x+a.offsetWidth,bottom:t.y+a.offsetHeight}:null},[d.elements,n]),O=r.useCallback(e=>{if(c&&C(e.clientX,e.clientY),(null==u?void 0:u.isResizing)&&P(e.clientX,e.clientY),T.current&&n.current){let a=n.current.getBoundingClientRect(),r=e.clientX-a.left+n.current.scrollLeft,i=e.clientY-a.top+n.current.scrollTop,l=y.current.x,o=y.current.y,s={x:Math.min(r,l),y:Math.min(i,o),width:Math.abs(r-l),height:Math.abs(i-o)};S.current=s,t({type:"SET_SELECTION_BOX",payload:s})}},[c,u,C,P,n,t]);r.useEffect(()=>{let e=()=>{if(M(),A(),T.current){let e=S.current;if(e){let n=new Set;d.elements.forEach(t=>{let a=k(t.id);a&&e.x<a.right&&e.x+e.width>a.left&&e.y<a.bottom&&e.y+e.height>a.top&&n.add(t.id)}),_.current?t({type:"SET_SELECTED_ELEMENT_IDS",payload:Array.from(new Set([...s,...n]))}):t({type:"SET_SELECTED_ELEMENT_IDS",payload:Array.from(n)}),n.size>0&&(h.current=!0)}t({type:"SET_SELECTION_BOX",payload:null}),S.current=null}T.current=!1};return window.addEventListener("mousemove",O),window.addEventListener("mouseup",e),()=>{window.removeEventListener("mousemove",O),window.removeEventListener("mouseup",e)}},[O,M,A,d.elements,k,t,s]);let L=r.useCallback((e,t)=>{0===e.button&&(e.target.closest("[data-resize-handle]")||b(t,e.clientX,e.clientY,e.shiftKey))},[b]),R=r.useCallback((e,t)=>{if(!o||e.target.closest("[data-resize-handle]"))return;let n=e.touches[0];1===e.touches.length&&(f.current=setTimeout(()=>{b(t,n.clientX,n.clientY,e.shiftKey),f.current=null},300))},[o,b]),X=r.useCallback(e=>{if(f.current){var t,n;let a=e.touches[0],r=Math.abs(a.clientX-(null!=(t=null==c?void 0:c.startX)?t:a.clientX)),i=Math.abs(a.clientY-(null!=(n=null==c?void 0:c.startY)?n:a.clientY));(r>5||i>5)&&(clearTimeout(f.current),f.current=null)}if(c){e.preventDefault();let t=e.touches[0];C(t.clientX,t.clientY)}if(null==u?void 0:u.isResizing){e.preventDefault();let t=e.touches[0];P(t.clientX,t.clientY)}},[c,u,C,P]),z=r.useCallback(()=>{f.current&&(clearTimeout(f.current),f.current=null),M(),A()},[M,A]),U=r.useCallback(e=>{if(h.current){h.current=!1;return}e.target===n.current&&t({type:"SET_SELECTED_ELEMENT_IDS",payload:[]}),g()},[g,n,t]);return{handleMouseDown:L,handleTouchStart:R,handleTouchMove:X,handleTouchEnd:z,handleContainerClick:U,handleCanvasMouseDown:r.useCallback(e=>{if(0===e.button&&o&&e.target===n.current){if(e.preventDefault(),T.current=!0,_.current=e.shiftKey,!n.current)return;let a=n.current.getBoundingClientRect();y.current={x:e.clientX-a.left+n.current.scrollLeft,y:e.clientY-a.top+n.current.scrollTop},t({type:"SET_SELECTION_BOX",payload:{...y.current,width:0,height:0}}),e.shiftKey||t({type:"SET_SELECTED_ELEMENT_IDS",payload:[]})}},[o,t,n]),handleResizeStart:N,handleContextMenu:r.useCallback(e=>{var n;if(!o)return;e.preventDefault();let a=null==(n=e.target.closest("[data-element-id]"))?void 0:n.getAttribute("data-element-id");a&&!s.includes(a)&&t({type:"SET_SELECTED_ELEMENT_IDS",payload:[a]}),t({type:"SET_CONTEXT_MENU",payload:{visible:!0,x:e.clientX,y:e.clientY,elementId:s.length>0?s[0]:void 0}})},[o,s,t]),closeContextMenu:g,addElement:I,deleteElement:w,openEditModal:D,handleUpdateElement:x,handleElementClick:v,getElementRect:k,handleMouseMove:e=>{if(n.current){let t=n.current.getBoundingClientRect();a.current={x:e.clientX-t.left,y:e.clientY-t.top}}}}}(e,t,a,d),{alignElements:C,reorderElement:M}=function(e,t,n,a){let{config:i,selectedElementIds:l}=e;return{alignElements:r.useCallback(e=>{if(l.length<2)return;let a=l.map(e=>n(e)).filter(e=>!!e);if(a.length<2)return;let r=a.find(e=>e.id===l[0]);r&&t({type:"UPDATE_ELEMENTS",payload:i.elements.map(t=>{if(!l.includes(t.id)||t.id===r.id)return t;let n=a.find(e=>e.id===t.id);if(!n)return t;let i=t.x,o=t.y;switch(e){case"left":i=r.left;break;case"center-h":i=r.left+r.width/2-n.width/2;break;case"right":i=r.right-n.width;break;case"top":o=r.top;break;case"center-v":o=r.top+r.height/2-n.height/2;break;case"bottom":o=r.bottom-n.height}return{...t,x:i,y:o}})})},[i.elements,l,t,n]),reorderElement:r.useCallback(e=>{if(1!==l.length)return;let n=l[0],r=[...i.elements].sort((e,t)=>(e.zIndex||0)-(t.zIndex||0)),o=r.findIndex(e=>e.id===n);if(-1===o)return;let s=[...i.elements],d=r[o].zIndex||0;switch(e){case"front":s.forEach(e=>{e.id===n&&(e.zIndex=r.length+1)});break;case"back":s.forEach(e=>{e.id===n&&(e.zIndex=0)});break;case"forward":if(o<r.length-1){let e=r[o+1].zIndex||0;s.find(e=>e.id===r[o+1].id).zIndex=d,s.find(e=>e.id===n).zIndex=e}break;case"backward":if(o>0){let e=r[o-1].zIndex||0;s.find(e=>e.id===r[o-1].id).zIndex=d,s.find(e=>e.id===n).zIndex=e}}let c=s.sort((e,t)=>(e.zIndex||0)-(t.zIndex||0));c.forEach((e,t)=>e.zIndex=t+1),t({type:"UPDATE_ELEMENTS",payload:c}),a()},[i.elements,l,t,a])}}(e,t,v,m),{handleCopy:N,handlePaste:P,handleSelectAll:A}=function(e,t){let{toast:n}=(0,i.dj)(),{selectedElementIds:a,config:l}=e,o=r.useRef([]),s=r.useCallback(()=>{if(a.length>0){let e=l.elements.filter(e=>a.includes(e.id));o.current=e,navigator.clipboard.writeText(JSON.stringify(e,null,2)),n({title:"Copied ".concat(a.length," element(s) to clipboard")})}},[a,l.elements,n]);return{handleCopy:s,handlePaste:r.useCallback(async e=>{try{let a=await navigator.clipboard.readText(),r=JSON.parse(a);if(Array.isArray(r)&&r.every(e=>e.id&&e.type&&null!=e.x&&null!=e.y)){let a=Math.max(0,...l.elements.map(e=>e.zIndex||0)),i=r.reduce((e,t)=>({minX:Math.min(e.minX,t.x),minY:Math.min(e.minY,t.y)}),{minX:1/0,minY:1/0}),o=e.x-i.minX,s=e.y-i.minY,d=r.map(e=>(a++,{...e,id:Date.now().toString()+Math.random(),x:e.x+o,y:e.y+s,zIndex:a})),c=d.map(e=>e.id);t({type:"UPDATE_ELEMENTS",payload:[...l.elements,...d]}),t({type:"SET_SELECTED_ELEMENT_IDS",payload:c}),n({title:"Pasted ".concat(d.length," element(s)")})}}catch(e){console.error("Failed to paste from clipboard:",e),n({variant:"destructive",title:"Paste failed",description:"Could not paste from clipboard. The content may not be valid."})}},[l.elements,t,n]),handleSelectAll:r.useCallback(()=>{t({type:"SET_SELECTED_ELEMENT_IDS",payload:l.elements.map(e=>e.id)})},[l.elements,t])}}(e,t);return!function(e,t,n,a){let{isEditMode:i,editingElement:l,selectedElementIds:o,config:s}=e,{handleCopy:d,handlePaste:c,deleteElement:u,handleSelectAll:E}=n,p=r.useCallback(async e=>{if(!i||l)return;if(e.metaKey||e.ctrlKey){if("c"===e.key){e.preventDefault(),d();return}if("v"===e.key){e.preventDefault(),await c(a.current);return}if("a"===e.key){e.preventDefault(),E(),setTimeout(()=>{d()},0);return}}if(0===o.length)return;let n=0,r=0;switch(e.key){case"ArrowUp":r=-1;break;case"ArrowDown":r=1;break;case"ArrowLeft":n=-1;break;case"ArrowRight":n=1;break;case"Delete":case"Backspace":e.preventDefault(),u();return;default:return}e.preventDefault(),t({type:"UPDATE_ELEMENTS",payload:s.elements.map(e=>o.includes(e.id)?{...e,x:e.x+n,y:e.y+r}:e)})},[i,l,o,s.elements,t,d,c,u,E,a]);r.useEffect(()=>(window.addEventListener("keydown",p),()=>{window.removeEventListener("keydown",p)}),[p])}(e,t,{handleCopy:N,handlePaste:P,deleteElement:I,handleSelectAll:A},d),{...e,mainContainerRef:a,handleEditModeToggle:c,handlePasswordSubmit:u,setPasswordInput:e=>t({type:"SET_PASSWORD_INPUT",payload:e}),handleContextMenu:_,closeContextMenu:m,addElement:g,deleteElement:I,openEditModal:w,handleUpdateElement:D,setEditingElement:e=>t({type:"SET_EDITING_ELEMENT",payload:e}),handleElementClick:x,handleMouseDown:E,handleTouchStart:p,handleTouchMove:f,handleTouchEnd:T,handleContainerClick:y,handleCanvasMouseDown:S,alignElements:C,reorderElement:M,setShowJsonExport:e=>t({type:"SET_SHOW_JSON_EXPORT",payload:e}),setShowPasswordPrompt:e=>t({type:"SET_SHOW_PASSWORD_PROMPT",payload:e}),handleResizeStart:h,handleMouseMove:b}}();return(0,a.jsx)(d.Provider,{value:n,children:t})},u=()=>{let e=(0,r.useContext)(d);if(void 0===e)throw Error("usePageEditorContext must be used within a PageEditorProvider");return e}}}]);